# andla_codegen
# Regfile Automatic Code Generation Tool User Guide

## Overview

This tool is used to automatically generate Regfile-related code, including Verilog and C header files. It uses a standardized CSV input file to define registers, then utilizes scripts to automatically generate the required output files and deploy them to their respective directories within the project.

## Directory Structure

- **Tool Path**: `$PVC_LOCALDIR/andes_ip/andla/tools/code_generation_v2/`
- **Core Scripts**:
    - `run.sh`: The main execution script that calls other Perl/Python scripts.
    - Various `.pl` (Perl) and `.py` (Python) files: Contain the logic for code generation.
- **Directories**:
    - `input/`: Contains template files (`.tmp.*`) for manual modifications (hand-coding).
    - `output/`: Contains the files automatically generated by the tool.

## Basic Usage

Navigate to the tool directory and simply execute `run.sh`.

```bash
cd $PVC_LOCALDIR/andes_ip/andla/tools/code_generation_v2/
./run.sh
```
This script will perform the following three actions:

1.  Read the register definition file.
2.  Generate all target files in the `output/` directory.
3.  Automatically copy the files from `output/` to their predefined project paths.

---

## Features

### 1. How to Add a New Register?

To add a new register, you need to modify the following CSV file:

- **File Path**: `$PVC_LOCALDIR/andes_ip/andla/doc/register_allocation.csv`

**Instructions**:
In the `register_allocation.csv` file, simply add a new row to define your new register. Follow the existing format to fill in the required fields. After saving the file, re-run `./run.sh`, and the new register will be included in the auto-generated code.

### 2. How to Modify the Destination Path of Generated Files?

The `./run.sh` script defines an associative array that maps the generated source files to their final destination paths.

**Instructions**:
1.  Open `./run.sh` in a text editor.
2.  Locate the `declare -A files=` block.

    ```bash
    # Snippet from run.sh

    14 declare -A files=(
    15     ["output/andla.vh"]="andes_ip/andla/hdl/include/andla.vh"
    16     ["output/andla.h"]="andes_vip/dv_lib/andla.h"
    17     ["output/andla_common.h"]="andes_vip/dv_lib/andla_common.h"
    18     ["output/regfile_map.h"]="andes_vip/dv_lib/regfile_map.h"
    19     ["output/andla_regfile.v"]="andes_ip/andla/hdl/andla_regfile.v"
    20     ["output/reg_constraint.h"]="andes_vip/dv/pattern/c/fme/reg_constraint.h"
    21 )
    ```

**Modification Details**:
-   The `key` (the part in `[...]`) is the source file in the `output/` directory, e.g., `output/andla.h`.
-   The `value` (the part after `=`) is the destination path where the file will be copied.
-   The prefix for all destination paths is automatically set to `$PVC_LOCALDIR`.
-   To change the destination for `andla.h`, you only need to modify the `"andes_vip/dv_lib/andla.h"` string.

### 3. How to Hand-code (Manually Modify) Generated Files?

Sometimes, you may need to add temporary or custom code to the auto-generated files. To prevent these manual changes from being overwritten the next time you run the script, please follow these steps.

**Instructions**:
1.  Navigate to the `input/` directory.
2.  Find the corresponding template file. For example, to modify `andla.h`, you would edit `input/andla.tmp.h`.
3.  Inside the template file, you will see markers like the ones below:

    ```c
    // ... other code ...

    // autogen_some_name_start
    // The content between these markers will be overwritten by
    // the auto-generated code when you run run.sh.
    // autogen_some_name_stop

    // ... other code ...
    ```

4.  **Place your manual code outside the `// autogen_*_start` and `// autogen_*_stop` block.**

    ```c
    // Example: Adding hand-code in andla.tmp.h
    
    // --- You can add your manual code here (before the block) ---
    #define MY_CUSTOM_MACRO 123
    // --- End of manual code ---
    
    // autogen_some_name_start
    // (Do not modify content here)
    // autogen_some_name_stop
    
    // --- Or you can add your manual code here (after the block) ---
    int my_custom_function(void);
    // --- End of manual code ---
    ```
5.  After saving the file, re-run `./run.sh`. The tool will preserve all your modifications outside the `autogen` blocks and integrate them into the final generated file.
